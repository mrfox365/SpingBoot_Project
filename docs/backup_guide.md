Посібник із резервного копіювання для системи керування класом

1. Стратегія резервного копіювання

1.1 Типи резервних копій
Повне резервне копіювання: виконується щотижня. Фіксує всю базу даних, конфігурації та контент, створений користувачами.
Інкрементне резервне копіювання: виконується щодня. Фіксує зміни, внесені з моменту останнього резервного копіювання.
Диференційне резервне копіювання: необов'язкове, виконується в середині тижня, щоб скоротити час відновлення порівняно з лише поступовим резервним копіюванням.

1.2 Частота резервного копіювання
Повний: Щонеділі о 2:00 AM
Інкрементальний: щодня о 2:00 (з понеділка по суботу)
Файли конфігурації: щотижня або при значних змінах системи
Журнали: Архівується кожні 3 дні

1.3 Зберігання та обертання
Резервні копії зберігаються на захищеному віддаленому сервері резервного копіювання із зашифрованим доступом.
Політика утримання:
Щоденні резервні копії: зберігаються протягом 7 днів
Щотижневі резервні копії: зберігаються протягом 4 тижнів
Щомісячні резервні копії: зберігаються протягом 6 місяців
Автоматичне обертання та очищення за допомогою завдань cron або конфігурації резервного інструменту

2. Процедура резервного копіювання

2.1 Резервне копіювання бази даних
Використовуйте pg_dump для створення резервних копій PostgreSQL:
pg_dump -U postgres classroom > /backups/classroom_$(date +%F).sql
Автоматизуйте за допомогою cron завдання та захистіть вихідний каталог.

2.2 Файли налаштувань
Включити:
application.properties or application.yml
Docker Compose files
Environment files (.env)

Команда резервного копіювання:
tar -czvf /backups/config_backup_$(date +%F).tar.gz /path/to/configs

2.3 Дані користувача
Створюйте резервні копії будь-яких завантажень або контенту, створеного користувачами:
tar -czvf /backups/uploads_backup_$(date +%F).tar.gz /path/to/uploads

2.4 Системні журнали
tar -czvf /backups/logs_$(date +%F).tar.gz /var/log/your-app

3. Перевірка цілісності резервного копіювання

Планування періодичних симуляцій відновлення в проміжному середовищі
Використовуйте контрольні суми (наприклад, SHA256) для перевірки цілісності файлу:
sha256sum /backups/classroom_2025-04-10.sql > /backups/checksums/classroom_2025-04-10.sha256

4. Автоматизація резервного копіювання

Приклад сценарію Bash

#!/bin/bash
BACKUP_DIR="/backups/$(date +%F)"
mkdir -p "$BACKUP_DIR"

# Database
pg_dump -U postgres classroom > "$BACKUP_DIR/classroom.sql"

# Config files
cp /path/to/configs/* "$BACKUP_DIR/"

# Logs
cp -r /var/log/your-app "$BACKUP_DIR/logs"

# User data
cp -r /path/to/uploads "$BACKUP_DIR/uploads"

Інструменти
cron
rsync
borgbackup, restic, or Duplicati
Cloud backups (AWS S3, Google Cloud Storage)

5. Процедура відновлення

5.1 Повне відновлення системи
Встановіть необхідне програмне забезпечення (PostgreSQL, app runtime)

Відновлення бази даних:
psql -U postgres classroom < /backups/classroom_2025-04-10.sql

Відновіть конфігураційні файли та дані користувача:
tar -xzvf config_backup.tar.gz -C /path/to/configs

Перезапустіть програму

5.2 Вибіркове відновлення даних
Видобування конкретних файлів користувача або версій конфігурації з .tar.gz

5.3 Відновлення після тестування
Щомісяця виконуйте тестові відновлення в стадії
Документуйте проблеми та забезпечуйте механізми відкату